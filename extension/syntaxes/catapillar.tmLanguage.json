{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Catapillar",
  "scopeName": "source.catapillar",
  "patterns": [
    { "include": "#block-comment" },
    { "include": "#line-comment" },
    { "include": "#function-definition" },
    { "include": "#control-block" },
    { "include": "#line-state" },
    { "include": "#block-end" },
    { "include": "#control-keywords" },
    { "include": "#action-keywords" },
    { "include": "#arithmetic-keywords" },
    { "include": "#arrow-operator" },
    { "include": "#comparison-operator" },
    { "include": "#boolean-constants" },
    { "include": "#numeric" },
    { "include": "#identifiers" }
  ],
  "repository": {
    "block-comment": {
      "name": "comment.block.catapillar",
      "begin": "^\\s*~~\\s*$",
      "end": "^\\s*~~\\s*$",
      "patterns": [
        {
          "name": "comment.block.content.catapillar",
          "match": ".*"
        }
      ]
    },
    "line-comment": {
      "name": "comment.line.number-sign.catapillar",
      "match": "#.*$"
    },
    "function-definition": {
      "match": "^\\s*(?:定|def)\\s+([\\w\\u4e00-\\u9fff]+)",
      "captures": {
        "0": { "name": "meta.function.catapillar" },
        "1": { "name": "entity.name.function.catapillar" }
      },
      "patterns": [
        {
          "name": "keyword.control.def.catapillar",
          "match": "\\b(?:定|def)\\b"
        }
      ]
    },
    "control-block": {
      "patterns": [
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(定|def)\\s+([\\w\\u4e00-\\u9fff]+)(.*)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.def.catapillar" },
            "2": { "name": "entity.name.function.catapillar" },
            "3": { "name": "variable.parameter.catapillar" },
            "4": { "name": "punctuation.definition.block.catapillar" }
          }
        },
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(若|if|又若|elif)\\s+(.+?)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.conditional.catapillar" },
            "2": {
              "patterns": [
                { "include": "#comparison-operator" },
                { "include": "#boolean-constants" },
                { "include": "#numeric" },
                { "include": "#identifiers" }
              ]
            },
            "3": { "name": "punctuation.definition.block.catapillar" }
          }
        },
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(否则|else|试|try|终于|finally)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.catapillar" },
            "2": { "name": "punctuation.definition.block.catapillar" }
          }
        },
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(当|while)\\s+(.+?)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.loop.catapillar" },
            "2": {
              "patterns": [
                { "include": "#comparison-operator" },
                { "include": "#boolean-constants" },
                { "include": "#numeric" },
                { "include": "#identifiers" }
              ]
            },
            "3": { "name": "punctuation.definition.block.catapillar" }
          }
        },
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(扭扭|for)\\s+(.+?)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.loop.catapillar" },
            "2": {
              "patterns": [
                { "include": "#identifiers" }
              ]
            },
            "3": { "name": "punctuation.definition.block.catapillar" }
          }
        },
        {
          "name": "meta.control.catapillar",
          "match": "^\\s*(捕|except)\\s*(.*?)(:)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.exception.catapillar" },
            "2": { "name": "entity.name.type.catapillar" },
            "3": { "name": "punctuation.definition.block.catapillar" }
          }
        }
      ]
    },
    "line-state": {
      "name": "keyword.operator.line-state.catapillar",
      "match": "^\\s*[~><!?](?=\\s)"
    },
    "block-end": {
      "name": "keyword.control.end.catapillar",
      "match": "^\\s*(?:终|end|结束|完了)\\s*$"
    },
    "control-keywords": {
      "name": "keyword.control.catapillar",
      "match": "(?:^|(?<=\\s))(?:定|def|若|if|又若|elif|否则|else|当|while|扭扭|for|断|break|续|continue|回|return|试|try|捕|except|终于|finally|空|pass)(?=\\s|:|$)"
    },
    "action-keywords": {
      "name": "keyword.other.action.catapillar",
      "match": "(?:^|(?<=\\s))(?:印|print|置|set|调|call)(?=\\s|$)"
    },
    "arithmetic-keywords": {
      "name": "keyword.operator.arithmetic.catapillar",
      "match": "(?:^|(?<=\\s))(?:加|add|减|sub|乘|mul|除|div)(?=\\s|$)"
    },
    "arrow-operator": {
      "name": "keyword.operator.arrow.catapillar",
      "match": "->|<-"
    },
    "comparison-operator": {
      "name": "keyword.operator.comparison.catapillar",
      "match": "(?:^|(?<=\\s))(?:是|不是|或|且)(?=\\s|$)"
    },
    "boolean-constants": {
      "name": "constant.language.catapillar",
      "match": "(?:^|(?<=\\s))(?:True|False|None|真|假)(?=\\s|$)"
    },
    "numeric": {
      "name": "constant.numeric.catapillar",
      "match": "(?:^|(?<=\\s))-?\\d+(?:\\.\\d+)?(?=\\s|$)"
    },
    "identifiers": {
      "name": "variable.other.catapillar",
      "match": "[\\w\\u4e00-\\u9fff]+"
    }
  }
}
