# Catapillar 行态（LineState）规范 v0.1

本文件定义 Catapillar 语言中的 **LineState（行态）** 语义规范。  
行态用于描述一行行为在执行流中的 **位置、阶段与关系**。

LineState 不定义语法结构，  
仅定义 **行为在流程中的推进、回溯与停顿方式**。

---

## 一、LineState 的基本概念

在 Catapillar 中：

- 每一行都是一个行为（Line）
    
- 行态用于标注该行为在整体行为流中的作用
    
- 行态决定 Segment 的边界与行为关系
    
- 行态不等价于 if / loop / block 等控制结构
    

---

## 二、v0.1 支持的行态一览

|符号|名称|语义说明|
|---|---|---|
|~|Continue|当前行为节继续|

> | Advance | 推进行为流，进入下一节  
> < | Back | 回看或引用上一节  
> ! | Commit | 关键节点，必须成立  
> ? | Await | 等待外部输入或事件

---

## 三、各行态的详细语义

### 1. `~` Continue（继续态）

表示当前行为属于当前 Segment，  
行为流不发生阶段切换。

示例（概念表达）：

`print hello ~ print world ~`

语义特征：

- 不创建新 Segment
    
- 不回溯、不推进
    
- 默认行态（省略时自动使用）
    

---

### 2. `>` Advance（推进态）

表示当前行为完成后，  
行为流进入下一 Segment。

示例：

`load data > process data ~`

语义特征：

- 结束当前 Segment
    
- 创建新的行为阶段
    
- 用于表达流程推进
    

---

### 3. `<` Back（回溯态）

表示当前行为引用、检查或作用于上一 Segment。

示例：

`compute result > log result <`

语义特征：

- 不创建新 Segment
    
- 语义上依赖上一节结果
    
- 用于回看、复用或修正
    

---

### 4. `!` Commit（断言态）

表示该行为为关键节点，  
其结果必须成立、可记录、可验证。

示例：

`save data !`

语义特征：

- 标记稳定点（checkpoint）
    
- 可用于日志、事务或状态固化
    
- v0.1 不强制绑定具体实现
    

---

### 5. `?` Await（等待态）

表示行为在此处暂停，  
等待外部输入、事件或回应。

示例：

`user input ?`

语义特征：

- 行为流暂停
    
- 不推进、不回溯
    
- 恢复方式由宿主环境决定
    

---

## 四、默认规则

- 若一行未显式标注行态，则默认使用 `~`
    
- 行态仅影响行为关系，不影响参数解析
    
- 行态不会改变 Action 或 Atom 的语义
    

---

## 五、行态与 Segment 的关系

- `~` ：当前 Segment 继续
    
- `>` ：结束当前 Segment，开启新 Segment
    
- `<` ：语义回指上一 Segment
    
- `!` ：在当前 Segment 内标记关键节点
    
- `?` ：在当前 Segment 内进入等待状态
    

Segment 的划分完全由行态驱动。

---

## 六、设计边界（v0.1）

在 v0.1 阶段，LineState：

- 不控制条件分支
    
- 不控制循环
    
- 不绑定异步模型
    
- 不定义执行顺序以外的逻辑
    

上述能力将在后续版本中通过 Action 或更高层结构引入。